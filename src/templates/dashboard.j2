{% extends "base.html" %}

{% block content %}
<h2>All Activity Trends</h2>

<div id="summary" class="summary-card">
  <h3>Summary</h3>
  <ul>
    <li><strong>{{ activity_data | length }}</strong> activities tracked</li>
    <li><strong>{{ total_actions }}</strong> total actions ({{ period }})</li>
    <li><strong>{{ trend_change }}%</strong> change vs last period</li>
  </ul>
</div>

<div class="activity-list">
  {% for activity in activity_data %}
  <div class="activity-card">
      <h3>{{ activity.name }}</h3>
      <canvas id="canvas-{{ loop.index0 }}" width="500" height="200"></canvas>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block head %}
<style>
.summary-card {
  background-color: #f9f9f9;
  padding: 1rem;
  border-radius: 0.5rem;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 1.5rem;
}

.activity-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.activity-card {
  background: white;
  padding: 1rem;
  border-radius: 0.75rem;
  box-shadow: 0 1px 4px rgba(0,0,0,0.15);
}

.activity-card h3 {
  margin-bottom: 0.5rem;
  color: #333;
}

canvas {
  width: 100%;
  height: auto;
  border: 1px solid #ddd;
  border-radius: 0.25rem;
}
</style>
{% endblock %}

{% block scripts %}
<script>
const activityData = {{ activity_data | tojson }};
activityData.forEach((activity, index) => {
  const canvas = document.getElementById(`canvas-${index}`);
  const ctx = canvas.getContext('2d');
  const trend = activity.trend_line;
  if (trend.length < 2) return;

  // Determine color by slope
  const first = trend[0];
  const last = trend[trend.length - 1];
  const color = last >= first ? '#4CAF50' : '#e74c3c';

  ctx.beginPath();
  ctx.moveTo(0, canvas.height - trend[0]*20);
  for(let i=1; i<trend.length; i++) {
      ctx.lineTo(i*(canvas.width/(trend.length-1)), canvas.height - trend[i]*20);
  }
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.stroke();
});
</script>
{% endblock %}
